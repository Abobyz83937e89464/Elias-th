<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elians Game</title>
    <style>
        body { margin: 0; background: #0b0f2a; color: white; font-family: sans-serif; text-align: center; }
        .screen { display: none; padding: 20px; }
        .active { display: block; }
        .btn { background: linear-gradient(135deg, #6a7cff, #a16bff); border: none; border-radius: 15px; padding: 12px 24px; color: white; cursor: pointer; margin: 10px; font-weight: bold; }
        input { padding: 12px; border-radius: 10px; border: none; margin: 10px; width: 80%; }
        #live-hint { font-size: 22px; color: #ffeb3b; min-height: 40px; margin: 20px; border: 1px dashed #555; padding: 10px; }
        #word-display { font-size: 28px; color: #4caf50; font-weight: bold; margin: 15px; }
    </style>
</head>
<body>

<div id="menu" class="screen active">
    <h1>ELIANS</h1>
    <button class="btn" onclick="createRoom()">Создать комнату</button><br>
    <input id="joinCode" placeholder="Код комнаты"><br>
    <button class="btn" onclick="joinRoom()">Войти в комнату</button>
</div>

<div id="room" class="screen">
    <h2 id="roomTitle">Ожидание...</h2>
    <div id="playerList"></div>
    <button class="btn" onclick="startRound()">НАЧАТЬ РАУНД</button>
</div>

<div id="game" class="screen">
    <div id="scoreBoard">Очки: A: 0 | B: 0</div>
    <div id="word-display"></div>
    <div id="live-hint">Подсказка появится тут...</div>
    <input id="hintInput" placeholder="Твоя подсказка..." oninput="sendHint()" style="display:none;">
    <button id="correctBtn" class="btn" onclick="correct()" style="display:none; background: #4caf50;">УГАДАЛИ!</button>
</div>

<script>
    const WS_URL = window.location.origin.replace(/^http/, 'ws');
    const ws = new WebSocket(WS_URL);
    const userId = "u" + Math.random().toString(36).substring(7);
    const username = "Игрок_" + Math.floor(Math.random()*100);

    ws.onopen = () => {
        console.log("WS подключен!");
        ws.send(JSON.stringify({ type: "REGISTER", userId, username }));
    };

    ws.onmessage = (e) => {
        const data = JSON.parse(e.data);
        console.log("Получено:", data);

        if (data.type === "ROOM_CREATED") {
            document.getElementById("roomTitle").innerText = "Код: " + data.roomId;
            showScreen("room");
        }
        if (data.type === "PLAYERS_UPDATE") {
            document.getElementById("playerList").innerHTML = data.players.map(p => `<div>${p.name} (Команда ${p.team})</div>`).join("");
            showScreen("room");
        }
        if (data.type === "ROUND_START") {
            showScreen("game");
            setupRole(data.role, data.word);
        }
        if (data.type === "HINT_LIVE") {
            document.getElementById("live-hint").innerText = data.from + ": " + data.text;
        }
        if (data.type === "SCORE_UPDATE") {
            document.getElementById("scoreBoard").innerText = `Очки: A: ${data.scores.A} | B: ${data.scores.B}`;
        }
        if (data.type === "NEW_WORD") {
            document.getElementById("word-display").innerText = "СЛОВО: " + data.word;
            document.getElementById("hintInput").value = "";
        }
    };

    function showScreen(id) {
        document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
    }

    function setupRole(role, word) {
        const isL = (role === "leader");
        document.getElementById("hintInput").style.display = isL ? "inline-block" : "none";
        document.getElementById("correctBtn").style.display = isL ? "inline-block" : "none";
        document.getElementById("word-display").innerText = isL ? "СЛОВО: " + word : "УГАДЫВАЙТЕ!";
    }

    function createRoom() { ws.send(JSON.stringify({ type: "CREATE_ROOM" })); }
    function joinRoom() { ws.send(JSON.stringify({ type: "JOIN_ROOM", roomId: document.getElementById("joinCode").value })); }
    function startRound() { ws.send(JSON.stringify({ type: "START_ROUND" })); }
    function sendHint() { ws.send(JSON.stringify({ type: "HINT", text: document.getElementById("hintInput").value })); }
    function correct() { ws.send(JSON.stringify({ type: "CORRECT" })); }
</script>
</body>
</html>
