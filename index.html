<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elias Arena Ultimate</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --neon: #00f3ff;
            --pink: #bc13fe;
            --bg: #050716;
            --card-bg: rgba(255, 255, 255, 0.07);
            --modal-bg: #101223;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 5px var(--neon); } 50% { box-shadow: 0 0 20px var(--neon); } 100% { box-shadow: 0 0 5px var(--neon); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; }

        /* --- –≠–ö–†–ê–ù–´ --- */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            padding: 20px;
        }
        .screen.active { display: flex; }

        /* --- –ú–ï–ù–Æ --- */
        .logo {
            font-size: 4rem;
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(to bottom, #fff, var(--neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 40px;
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.4));
        }

        .menu-btns { width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 15px; }

        .btn {
            width: 100%;
            padding: 18px;
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.1);
            background: var(--card-bg);
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:active { transform: scale(0.96); background: rgba(255,255,255,0.15); }
        .btn-main {
            background: var(--neon);
            color: black;
            border: none;
            box-shadow: 0 10px 20px rgba(0, 243, 255, 0.2);
        }

        /* --- –ú–û–î–ê–õ–ö–ò --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            display: none;
            align-items: flex-end;
        }
        .modal-overlay.open { display: flex; }
        .modal-card {
            width: 100%;
            background: var(--modal-bg);
            border-radius: 35px 35px 0 0;
            padding: 40px 25px;
            animation: slideUp 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .modal-title { font-size: 1.6rem; font-weight: 800; margin-bottom: 25px; text-align: center; }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞ */
        .code-input-wrapper { display: flex; justify-content: center; margin-bottom: 20px; }
        .compact-input {
            width: 160px;
            background: #000;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 15px;
            color: var(--neon);
            font-size: 1.8rem;
            font-weight: 900;
            text-align: center;
            letter-spacing: 5px;
            text-transform: uppercase;
            outline: none;
        }
        .compact-input:focus { border-color: var(--neon); }

        /* --- –õ–û–ë–ë–ò --- */
        .room-badge { background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; color: #888; margin-bottom: 10px; }
        .room-id-text { font-size: 4rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px var(--neon); margin: 0 0 30px 0; }
        
        #player-list-container {
            width: 100%;
            background: var(--card-bg);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .player-row { padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; gap: 10px; }
        .player-row:last-child { border: none; }
        .dot { width: 8px; height: 8px; background: var(--neon); border-radius: 50%; }

        .facts-slider {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            font-size: 0.85rem;
            color: #666;
            min-height: 80px;
            transition: 0.3s;
        }

        /* --- –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù (–ê–†–ï–ù–ê) --- */
        .arena {
            display: none;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 100px 1fr 120px 80px;
            height: 100vh;
            gap: 12px;
            padding: 15px;
        }
        .p-card {
            background: var(--card-bg);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }
        .p-card.active-exp { border: 2px solid var(--pink); box-shadow: 0 0 15px rgba(188, 19, 254, 0.3); }
        .p-card.active-guess { border: 2px solid var(--neon); box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); }
        .p-name { font-size: 0.9rem; font-weight: 600; margin-top: 5px; }

        .center-hub {
            grid-column: span 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .main-word { font-size: 2.8rem; font-weight: 900; color: var(--neon); text-transform: uppercase; line-height: 1; }
        .explanation-hint { font-size: 0.9rem; color: #888; margin-top: 8px; max-width: 80%; }
        
        #timer-display {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--pink);
            margin-bottom: 10px;
        }

        #chat-box {
            grid-column: span 2;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .msg-item { background: rgba(255,255,255,0.04); padding: 8px 12px; border-radius: 12px; font-size: 0.9rem; animation: fadeIn 0.3s ease; }
        .msg-item b { color: var(--neon); }

        .game-controls {
            grid-column: span 2;
            display: flex;
            gap: 10px;
        }
        .chat-input {
            flex: 1;
            background: #111;
            border: 1px solid #333;
            border-radius: 15px;
            color: white;
            padding: 0 20px;
            font-size: 1rem;
            outline: none;
        }
        .btn-skip { background: #ff4757; color: white; border: none; border-radius: 15px; padding: 0 20px; font-weight: bold; }

        #flash-effect { position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 2000; }
    </style>
</head>
<body>

<div id="flash-effect"></div>

<div id="menu-screen" class="screen active">
    <div class="logo fade-in">ELIAS</div>
    <div class="menu-btns fade-in">
        <button class="btn btn-main" onclick="openM('modal-create')">–°–û–ó–î–ê–¢–¨ –ö–û–ú–ù–ê–¢–£</button>
        <button class="btn" onclick="openM('modal-join')">–ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø</button>
        <button class="btn" onclick="openM('modal-help')" style="opacity: 0.6; font-size: 0.9rem;">–ü–†–ê–í–ò–õ–ê –ò–ì–†–´</button>
    </div>
</div>

<div id="lobby-screen" class="screen">
    <div class="room-badge fade-in">–ö–û–î –ö–û–ú–ù–ê–¢–´</div>
    <h1 id="display-room-id" class="room-id-text fade-in">-</h1>
    
    <div id="player-list-container" class="fade-in">
        <div id="players-list"></div>
    </div>
    
    <button id="start-game-btn" class="btn btn-main fade-in" style="display:none;" onclick="startGame()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
    <p id="admin-wait-msg" style="color: #444; font-size: 0.8rem;">–ñ–¥–µ–º, –ø–æ–∫–∞ –∞–¥–º–∏–Ω –∑–∞–ø—É—Å—Ç–∏—Ç –º–∞—Ç—á...</p>

    <div id="facts-area" class="facts-slider">
        –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–æ–≤–µ—Ç–æ–≤...
    </div>
</div>

<div id="game-screen" class="arena">
    <div id="p0" class="p-card"><span class="p-name">–ò–≥—Ä–æ–∫ 1</span></div>
    <div id="p1" class="p-card"><span class="p-name">–ò–≥—Ä–æ–∫ 2</span></div>
    
    <div class="center-hub">
        <div id="timer-display">60</div>
        <div id="main-word-box" class="main-word">...</div>
        <div id="main-word-sub" class="explanation-hint">–ñ–¥–µ–º –Ω–∞—á–∞–ª–∞ —Ö–æ–¥–∞...</div>
        
        <div style="margin-top:15px; font-size:0.8rem; font-weight:bold; letter-spacing:1px;">
            <span style="color: var(--neon)">TEAM A: <span id="scoreA">0</span></span>
            <span style="margin: 0 10px; color:#333;">|</span>
            <span style="color: var(--pink)">TEAM B: <span id="scoreB">0</span></span>
        </div>
    </div>

    <div id="p2" class="p-card"><span class="p-name">–ò–≥—Ä–æ–∫ 3</span></div>
    <div id="p3" class="p-card"><span class="p-name">–ò–≥—Ä–æ–∫ 4</span></div>

    <div id="chat-box"></div>

    <div class="game-controls">
        <input id="game-input" class="chat-input" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç –∏–ª–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ...">
        <button id="skip-word-btn" class="btn-skip" style="display:none;" onclick="skipWord()">SKIP</button>
    </div>
</div>

<div id="modal-create" class="modal-overlay" onclick="closeM('modal-create')">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</div>
        <button class="btn" style="margin-bottom:10px;" onclick="createRoom('online')">‚öîÔ∏è –û–ù–õ–ê–ô–ù –ë–ê–¢–¢–õ (2x2)</button>
        <button class="btn" onclick="createRoom('call')">üìû –†–ï–ñ–ò–ú –°–û–ó–í–û–ù–ê</button>
    </div>
</div>

<div id="modal-join" class="modal-overlay" onclick="closeM('modal-join')">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-title">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</div>
        <div class="code-input-wrapper">
            <input id="join-code-field" class="compact-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="5">
        </div>
        <button class="btn btn-main" onclick="joinRoom()">–ü–†–ò–°–û–ï–î–ò–ù–ò–¢–¨–°–Ø</button>
    </div>
</div>

<div id="modal-help" class="modal-overlay" onclick="closeM('modal-help')">
    <div class="modal-card" onclick="event.stopPropagation()">
        <div class="modal-title">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</div>
        <div style="color: #aaa; line-height: 1.6; font-size: 0.95rem; margin-bottom: 20px;">
            1. –í–µ–¥—É—â–∏–π –≤–∏–¥–∏—Ç —Å–ª–æ–≤–æ –∏ –æ–±—ä—è—Å–Ω—è–µ—Ç –µ–≥–æ –≤ —á–∞—Ç–µ.<br>
            2. <b>–ù–µ–ª—å–∑—è</b> –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞!<br>
            3. –ï—Å–ª–∏ —Å–ª–æ–≤–æ "–†–ê–ö–ï–¢–ê", –ø–∏—à–∏: <i>"–û–Ω–æ –ª–µ—Ç–∏—Ç –≤ –∫–æ—Å–º–æ—Å"</i>.<br>
            4. –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–ª–æ–≤–æ –≤ —á–∞—Ç.<br>
            5. –ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –Ω–∞–±–µ—Ä–µ—Ç 40 –æ—á–∫–æ–≤.
        </div>
        <button class="btn btn-main" onclick="closeM('modal-help')">–í–°–Å –ü–û–ù–Ø–¢–ù–û</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.headerColor = "#050716";

    // –ê–í–¢–û-–ê–î–†–ï–° –°–û–ö–ï–¢–ê
    const ws = new WebSocket(`${location.protocol === 'https:' ? 'wss:' : 'ws:'}//${location.host}`);
    
    let myName = tg.initDataUnsafe.user?.first_name || "–ò–≥—Ä–æ–∫ " + Math.floor(Math.random()*100);
    let myRole = "";

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    function openM(id) { document.getElementById(id).classList.add('open'); }
    function closeM(id) { document.getElementById(id).classList.remove('open'); }
    
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('game-screen').style.display = 'none';
        
        const target = document.getElementById(id);
        if(id === 'game-screen') target.style.display = 'grid';
        else target.classList.add('active');
    }

    // –õ–û–ì–ò–ö–ê –°–û–ö–ï–¢–û–í
    ws.onopen = () => {
        ws.send(JSON.stringify({ type: "REGISTER", username: myName }));
    };

    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);

        switch(data.type) {
            case "ROOM_CREATED":
            case "JOIN_SUCCESS":
                document.getElementById('display-room-id').innerText = data.roomId;
                showScreen('lobby-screen');
                closeM('modal-create');
                closeM('modal-join');
                break;

            case "LOBBY_UPDATE":
                const list = document.getElementById('players-list');
                list.innerHTML = data.players.map(p => `
                    <div class="player-row"><div class="dot"></div> <b>${p}</b></div>
                `).join('');
                
                // –ï—Å–ª–∏ —è –ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ - —è –∞–¥–º–∏–Ω
                if(data.players[0] === myName) {
                    document.getElementById('start-game-btn').style.display = "flex";
                    document.getElementById('admin-wait-msg').style.display = "none";
                }
                break;

            case "ROUND_START":
                showScreen('game-screen');
                setupRound(data);
                break;

            case "TIMER_TICK":
                document.getElementById('timer-display').innerText = data.time;
                break;

            case "NEW_WORD":
                document.getElementById('main-word-box').innerText = data.word;
                document.getElementById('main-word-sub').innerText = `–û–±—ä—è—Å–Ω–∏ —Å–ª–æ–≤–æ "${data.word}" —Å–≤–æ–µ–π –∫–æ–º–∞–Ω–¥–µ –≤ —á–∞—Ç–µ!`;
                break;

            case "CHAT_NEW":
                const chat = document.getElementById('chat-box');
                const div = document.createElement('div');
                div.className = 'msg-item';
                div.innerHTML = `<b>${data.from}:</b> ${data.text}`;
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
                break;

            case "SCORE_UPDATE":
                document.getElementById('scoreA').innerText = data.scores.A;
                document.getElementById('scoreB').innerText = data.scores.B;
                break;

            case "WIN_ANIM":
                const flash = document.getElementById('flash-effect');
                flash.style.opacity = "0.5";
                setTimeout(() => flash.style.opacity = "0", 300);
                break;
        }
    };

    function setupRound(d) {
        const wordBox = document.getElementById('main-word-box');
        const hintBox = document.getElementById('main-word-sub');
        const skipBtn = document.getElementById('skip-word-btn');
        
        myRole = d.role;

        if(d.role === 'explainer') {
            wordBox.innerText = d.word;
            wordBox.style.color = "var(--neon)";
            hintBox.innerText = `–î–∞–≤–∞–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ —á–∞—Ç! –í–µ–¥—É—â–∏–π: ${d.explainerName}`;
            skipBtn.style.display = "block";
        } else if(d.role === 'guesser') {
            wordBox.innerText = "–£–ì–ê–î–ê–ô –°–õ–û–í–û";
            wordBox.style.color = "#fff";
            hintBox.innerText = `–°–º–æ—Ç—Ä–∏ –≤ —á–∞—Ç! –¢–≤–æ–π –≤–µ–¥—É—â–∏–π: ${d.explainerName}`;
            skipBtn.style.display = "none";
        } else {
            wordBox.innerText = "–ñ–î–ï–ú –•–û–î–ê...";
            wordBox.style.color = "#444";
            hintBox.innerText = `–°–µ–π—á–∞—Å —Ö–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥–∞ ${d.team}`;
            skipBtn.style.display = "none";
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
        d.playersInfo.forEach((p, i) => {
            const card = document.getElementById('p' + i);
            if(card) {
                card.innerHTML = `<span class="p-name">${p.name}</span><span style="font-size:0.6rem; opacity:0.4">${p.team}</span>`;
                card.className = "p-card";
                if(p.name === d.explainerName) card.classList.add('active-exp');
                else if(p.team === d.team) card.classList.add('active-guess');
            }
        });
    }

    // –î–ï–ô–°–¢–í–ò–Ø
    function createRoom(mode) { ws.send(JSON.stringify({ type: "CREATE_ROOM", mode })); }
    
    function joinRoom() {
        const code = document.getElementById('join-code-field').value.toUpperCase();
        if(code) ws.send(JSON.stringify({ type: "JOIN_ROOM", roomId: code }));
    }

    function startGame() { ws.send(JSON.stringify({ type: "START_GAME" })); }

    function skipWord() { ws.send(JSON.stringify({ type: "SKIP_WORD" })); }

    // –ß–∞—Ç
    document.getElementById('game-input').addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && e.target.value.trim() !== '') {
            ws.send(JSON.stringify({ type: "CHAT_MESSAGE", text: e.target.value }));
            e.target.value = '';
        }
    });

    // –§–∞–∫—Ç—ã
    const facts = [
        "–°–æ–≤–µ—Ç: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –∂–µ—Å—Ç—ã, –ø–∏—à–∏ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç!",
        "–§–∞–∫—Ç: –í Elias Arena –ø–æ–±–µ–∂–¥–∞–µ—Ç —Å–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è –∫–æ–º–∞–Ω–¥–∞.",
        "–°–æ–≤–µ—Ç: –ü—Ä–æ–ø—É—Å–∫ —Å–ª–æ–≤–∞ –æ—Ç–Ω–∏–º–∞–µ—Ç 1 –æ—á–∫–æ ‚Äî –±—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω!",
        "–§–∞–∫—Ç: –¢—ã –º–æ–∂–µ—à—å –∏–≥—Ä–∞—Ç—å –≤ Elias –¥–∞–∂–µ –≤ –≤–∏–¥–µ–æ-–∑–≤–æ–Ω–∫–∞—Ö.",
        "–°–æ–≤–µ—Ç: –ß–µ–º –∫–æ—Ä–æ—á–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ —Ç–µ–±—è –ø–æ–π–º—É—Ç!"
    ];
    setInterval(() => {
        const area = document.getElementById('facts-area');
        area.style.opacity = 0;
        setTimeout(() => {
            area.innerText = facts[Math.floor(Math.random()*facts.length)];
            area.style.opacity = 1;
        }, 300);
    }, 6000);

</script>
</body>
</html>
