<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Elians</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #0b0f2a, #050716);
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
}

.screen { display: none; padding: 20px; }
.active { display: block; }

.btn {
  background: linear-gradient(135deg, #6a7cff, #a16bff);
  border: none;
  border-radius: 20px;
  padding: 10px 16px;
  color: white;
  font-weight: 600;
  margin: 6px;
  cursor: pointer;
}

.card {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(124,138,255,0.3);
  border-radius: 16px;
  padding: 14px;
  margin: 10px auto;
  max-width: 420px;
}

.game-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  max-width: 650px;
  margin: 10px auto;
}

.player {
  background: rgba(255,255,255,0.06);
  border-radius: 16px;
  padding: 10px;
}
</style>
</head>

<body>

<div id="menu" class="screen active">
  <h2>Elians</h2>
  <button class="btn" onclick="createRoom()">Создать комнату</button>
  <input id="joinCode" placeholder="Код комнаты">
  <button class="btn" onclick="joinRoom()">Войти</button>
  <button class="btn" onclick="getOnline()">Список онлайн</button>
</div>

<div id="online" class="screen">
  <h3>Онлайн игроки</h3>
  <div id="onlineList"></div>
  <button class="btn" onclick="show('menu')">Назад</button>
</div>

<div id="room" class="screen">
  <h3>Комната: <span id="roomId"></span></h3>
  <div id="players"></div>
  <button class="btn" onclick="startRound()">Начать раунд</button>
</div>

<div id="game" class="screen">
  <h3>Игра идёт</h3>
  <div>⏱ <span id="time">60</span> сек</div>
  <div class="game-grid">
    <div class="player" id="p1">Игрок 1 — A</div>
    <div class="player" id="p2">Игрок 2 — A</div>
    <div class="player" id="p3">Игрок 3 — B</div>
    <div class="player" id="p4">Игрок 4 — B</div>
  </div>

  <input id="hint" placeholder="Подсказка" oninput="sendHint()"><br>
  <input id="guess" placeholder="Угадать" onkeypress="sendGuess(event)"><br>

  <button class="btn" onclick="skipWord()">СКИП</button>
  <button class="btn" onclick="correctWord()">УГАДАЛИ</button>
  <button class="btn" onclick="lastWord()">ПОСЛЕДНЕЕ СЛОВО</button>
</div>

<div id="lastWordOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; color:white; align-items:center; justify-content:center;">
  <h1>ПОСЛЕДНЕЕ СЛОВО!<br>Пробуйте угадать!</h1>
</div>

<script>
const WS_URL = location.protocol === "https:"
  ? `wss://${location.host}`
  : `ws://${location.host}`;

const ws = new WebSocket(WS_URL);

const userId = "u" + Math.random().toString(36).substring(2, 9);
const username = "Игрок_" + userId;
let currentRoom = null;

function show(id){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

ws.onopen = () => {
  ws.send(JSON.stringify({
    type: "REGISTER",
    userId,
    username
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);

  switch (data.type) {
    case "ROOM_CREATED":
      currentRoom = data.roomId;
      document.getElementById("roomId").innerText = currentRoom;
      show("room");
      break;

    case "PLAYERS_UPDATE":
      const list = document.getElementById("players");
      list.innerHTML = "";
      data.players.forEach(p => {
        const d = document.createElement("div");
        d.innerText = p;
        list.appendChild(d);
      });
      break;

    case "ONLINE_USERS":
      const online = document.getElementById("onlineList");
      online.innerHTML = "";
      data.users.forEach(u => {
        const d = document.createElement("div");
        d.innerText = u.username;

        const btn = document.createElement("button");
        btn.innerText = "Пригласить";
        btn.onclick = () => invite(u.userId);

        d.appendChild(btn);
        online.appendChild(d);
      });
      show("online");
      break;

    case "INVITE":
      alert(`Приглашение от ${data.from} в комнату ${data.roomId}`);
      currentRoom = data.roomId;
      ws.send(JSON.stringify({ type: "JOIN_ROOM", roomId: data.roomId }));
      show("room");
      break;

    case "ROUND_START":
      document.getElementById("time").innerText = data.time;
      show("game");
      break;

    case "TIMER":
      document.getElementById("time").innerText = data.time;
      break;

    case "SCORE_UPDATE":
      console.log("Очки:", data.scores);
      break;

    case "LAST_WORD":
      document.getElementById("lastWordOverlay").style.display = "flex";
      break;
  }
};

function createRoom(){
  ws.send(JSON.stringify({ type: "CREATE_ROOM" }));
}

function joinRoom(){
  const code = document.getElementById("joinCode").value.trim();
  ws.send(JSON.stringify({ type: "JOIN_ROOM", roomId: code }));
}

function getOnline(){
  ws.send(JSON.stringify({ type: "GET_ONLINE_USERS" }));
}

function invite(targetUserId){
  ws.send(JSON.stringify({
    type: "INVITE",
    roomId: currentRoom,
    targetUserId
  }));
}

function startRound(){
  ws.send(JSON.stringify({ type: "START_ROUND" }));
}

function sendHint(){
  ws.send(JSON.stringify({
    type: "HINT",
    text: document.getElementById("hint").value
  }));
}

function sendGuess(e){
  if (e.key === "Enter"){
    ws.send(JSON.stringify({
      type: "GUESS",
      text: document.getElementById("guess").value
    }));
    document.getElementById("guess").value = "";
  }
}

function skipWord(){
  ws.send(JSON.stringify({ type: "SKIP" }));
}

function correctWord(){
  ws.send(JSON.stringify({ type: "CORRECT" }));
}

function lastWord(){
  ws.send(JSON.stringify({ type: "LAST_WORD" }));
}
</script>

</body>
</html>
