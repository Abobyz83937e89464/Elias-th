<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elians Neon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --neon: #00f3ff; --pink: #bc13fe; --bg: #050716; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; overflow: hidden; }
        
        .screen { display: none; flex-direction: column; align-items: center; padding: 20px; height: 100vh; box-sizing: border-box; animation: fadeIn 0.5s; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        h1 { font-size: 3rem; margin-bottom: 10px; text-shadow: 0 0 15px var(--neon); letter-spacing: 5px; }

        .btn {
            background: linear-gradient(135deg, var(--neon), var(--pink));
            border: none; border-radius: 20px; padding: 16px; color: white; font-weight: bold; font-size: 1.1rem;
            width: 90%; max-width: 350px; margin: 10px 0; cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); transition: transform 0.2s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-outline { background: transparent; border: 2px solid var(--neon); box-shadow: none; color: var(--neon); }

        .mode-card {
            background: rgba(255,255,255,0.05); border: 1px solid var(--pink); border-radius: 20px;
            padding: 20px; width: 85%; margin: 10px; cursor: pointer; text-align: left;
            transition: 0.3s;
        }
        .mode-card:hover { background: rgba(188, 19, 254, 0.1); transform: translateY(-3px); }

        input { background: rgba(255,255,255,0.1); border: 1px solid var(--neon); padding: 15px; border-radius: 15px; color: white; width: 80%; text-align: center; font-size: 1.2rem; margin: 10px 0; }

        /* –õ–æ–±–±–∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .lobby-code { font-size: 2.5rem; color: var(--neon); text-shadow: 0 0 20px var(--neon); margin: 20px 0; letter-spacing: 3px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; text-shadow: 0 0 30px var(--neon); } 100% { opacity: 0.8; } }
        
        .fact-box {
            background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px; border-left: 3px solid var(--pink);
            margin-top: auto; margin-bottom: 20px; font-size: 0.9rem; color: #ddd; min-height: 80px;
            display: flex; flex-direction: column; justify-content: center;
        }

        /* –ò–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .timer-bar { height: 5px; background: var(--pink); width: 100%; position: absolute; top: 0; left: 0; box-shadow: 0 0 10px var(--pink); }
        .status-badge { background: var(--neon); color: black; padding: 5px 15px; border-radius: 20px; font-weight: bold; display: inline-block; margin-bottom: 15px; }
        .score-board { display: flex; justify-content: space-around; width: 100%; padding: 10px; background: rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="menu" class="screen active">
    <h1>ELIANS</h1>
    <p style="color: #aaa; margin-top: -10px;">Neon Party Game</p>
    <button class="btn" onclick="showScreen('modes')">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
    <input id="joinInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
    <button class="btn btn-outline" onclick="joinRoom()">–í–æ–π—Ç–∏</button>
</div>

<div id="modes" class="screen">
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</h2>
    <div class="mode-card" onclick="createRoom('online')">
        <h3 style="margin:0">üåê –ü–æ —Å–µ—Ç–∏</h3>
        <p style="font-size:0.8rem; color:#ccc">–ö–ª–∞—Å—Å–∏–∫–∞. –ß–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í—ã –ø–∏—à–∏—Ç–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.</p>
    </div>
    <div class="mode-card" onclick="createRoom('call')">
        <h3 style="margin:0">üìû –°–æ–∑–≤–æ–Ω</h3>
        <p style="font-size:0.8rem; color:#ccc">–î–ª—è –∑–≤–æ–Ω–∫–æ–≤ –≤ –¢–ì/–î–∏—Å–∫–æ—Ä–¥. –ß–∞—Ç —Å–∫—Ä—ã—Ç. –ü—Ä–æ—Å—Ç–æ —Å—á–∏—Ç–∞–π—Ç–µ –æ—á–∫–∏.</p>
    </div>
    <button class="btn btn-outline" onclick="showScreen('menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="lobby" class="screen">
    <h2 style="color:white">–û–ñ–ò–î–ê–ù–ò–ï...</h2>
    <div id="lobbyCode" class="lobby-code">---</div>
    
    <div id="lobbyList" style="margin-bottom: 20px; width: 100%;">
        <div style="opacity: 0.6">–ñ–¥–µ–º –∏–≥—Ä–æ–∫–æ–≤...</div>
    </div>
    
    <button class="btn" onclick="inviteFriend()">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π üì§</button>
    
    <button id="startBtn" class="btn" style="background: #2ecc71; display:none;" onclick="ws.send(JSON.stringify({type:'START_GAME'}))">–ü–û–ì–ù–ê–õ–ò! üöÄ</button>

    <div class="fact-box">
        <b style="color: var(--neon)">üí° –ê –≤—ã –∑–Ω–∞–ª–∏?</b>
        <span id="factText">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–∫—Ç–∞...</span>
    </div>
    <button class="btn btn-outline" style="margin-top: 10px; padding: 10px;" onclick="showScreen('menu')">–í—ã–π—Ç–∏</button>
</div>

<div id="game" class="screen">
    <div class="timer-bar" id="timerBar"></div>
    <div class="score-board">
        <span style="color:var(--neon)">TEAM A: <b id="scoreA">0</b></span>
        <span style="color:var(--pink)">TEAM B: <b id="scoreB">0</b></span>
    </div>

    <div id="gameContent" style="display: flex; flex-direction: column; align-items: center; width: 100%; margin-top: 30px;">
        </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    const ws = new WebSocket(`${location.protocol==='https:'?'wss:':'ws:'}//${location.host}`);
    
    let currentRoom = "";
    let currentMode = "online";
    let factInterval;
    
    const facts = [
        "Alias –±—ã–ª –ø—Ä–∏–¥—É–º–∞–Ω –≤ –§–∏–Ω–ª—è–Ω–¥–∏–∏ –≤ –Ω–∞—á–∞–ª–µ 90-—Ö.",
        "–†–µ–∫–æ—Ä–¥ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Å–ª–æ–≤: 30 —à—Ç—É–∫ –∑–∞ –º–∏–Ω—É—Ç—É!",
        "–°–ª–æ–≤–æ '–ú–æ—Ä—Ñ–µ—É—Å' –æ–±—ä—è—Å–Ω—è—é—Ç —á–∞—â–µ –≤—Å–µ–≥–æ –∫–∞–∫ '–ù–µ–æ'.",
        "–°–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è.",
        "–í —Ä–µ–∂–∏–º–µ '–°–æ–∑–≤–æ–Ω' –º–æ–∂–Ω–æ –∫—Ä–∏—á–∞—Ç—å –≥—Ä–æ–º—á–µ!",
        "–ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ —Å–ª–æ–≤–æ ‚Äî –ª—É—á—à–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ."
    ];

    ws.onopen = () => ws.send(JSON.stringify({ 
        type: "REGISTER", 
        userId: tg.initDataUnsafe.user?.id || Math.random(), 
        username: tg.initDataUnsafe.user?.first_name || "–ò–≥—Ä–æ–∫" 
    }));

    ws.onmessage = (e) => {
        const d = JSON.parse(e.data);

        // –°–æ–∑–¥–∞–Ω–∏–µ
        if(d.type === "ROOM_CREATED") {
            currentRoom = d.roomId;
            setupLobby(d.roomId);
        }
        
        // –í—Ö–æ–¥ (–¥–ª—è —Ç–æ–≥–æ, –∫—Ç–æ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è)
        if(d.type === "JOIN_SUCCESS") {
            currentRoom = d.roomId;
            currentMode = d.mode;
            setupLobby(d.roomId);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–±–±–∏ (—Å–ø–∏—Å–æ–∫)
        if(d.type === "LOBBY_UPDATE") {
            document.getElementById('lobbyList').innerHTML = d.players.map(p => `<div>üë§ ${p}</div>`).join("");
            if (d.count >= 2) document.getElementById('startBtn').style.display = "block"; // –ü–æ—Ä–æ–≥ –∏–≥—Ä–æ–∫–æ–≤ (–º–∏–Ω 2 –¥–ª—è —Ç–µ—Å—Ç–∞)
        }

        if(d.type === "ERROR") tg.showAlert(d.text);

        if(d.type === "ROUND_START") {
            showScreen('game');
            clearInterval(factInterval); // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–∫—Ç—ã
            renderGameScreen(d);
            startTimer(d.time);
        }

        if(d.type === "LIVE_HINT") {
            const el = document.getElementById('liveHintText');
            if(el) el.innerText = d.text;
        }

        if(d.type === "SCORE_UPDATE") {
            document.getElementById('scoreA').innerText = d.scores.A;
            document.getElementById('scoreB').innerText = d.scores.B;
        }

        if(d.type === "NEW_WORD") {
            const el = document.getElementById('wordBox');
            if(el) el.innerText = d.word;
            const inp = document.getElementById('hintInput');
            if(inp) inp.value = '';
        }
    };

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function createRoom(mode) {
        currentMode = mode;
        ws.send(JSON.stringify({ type: "CREATE_ROOM", mode: mode }));
    }

    function joinRoom() {
        const code = document.getElementById('joinInput').value;
        if(code) ws.send(JSON.stringify({ type: "JOIN_ROOM", roomId: code }));
    }

    function setupLobby(code) {
        document.getElementById('lobbyCode').innerText = code;
        showScreen('lobby');
        
        // –ó–∞–ø—É—Å–∫ —Ñ–∞–∫—Ç–æ–≤
        const factEl = document.getElementById('factText');
        factEl.innerText = facts[0];
        if(factInterval) clearInterval(factInterval);
        factInterval = setInterval(() => {
            factEl.innerText = facts[Math.floor(Math.random() * facts.length)];
        }, 4000);
    }

    function inviteFriend() {
        const text = `–ó–∞–ª–µ—Ç–∞–π –∫–æ –º–Ω–µ –≤ Alias! –ö–æ–¥: ${currentRoom}`;
        // –ü—Ä–æ–±—É–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π —à–µ—Ä–∏–Ω–≥ –¢–µ–ª–µ–≥—Ä–∞–º–∞
        const url = `https://t.me/share/url?url=${encodeURIComponent(text)}`;
        tg.openTelegramLink(url);
    }

    function sendHint() {
        const val = document.getElementById('hintInput').value;
        ws.send(JSON.stringify({ type: "HINT", text: val }));
    }

    function renderGameScreen(d) {
        const container = document.getElementById('gameContent');
        container.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞

        // 1. –¢–´ –í–ï–î–£–©–ò–ô
        if(d.role === 'explainer') {
            container.innerHTML = `
                <div class="status-badge">–¢–´ –û–ë–™–Ø–°–ù–Ø–ï–®–¨</div>
                <div style="font-size:2.5rem; font-weight:bold; margin:20px 0; text-shadow:0 0 20px var(--pink)" id="wordBox">${d.word}</div>
                ${d.mode === 'online' ? `<input id="hintInput" placeholder="–ü–∏—à–∏ –ø–æ–¥—Å–∫–∞–∑–∫—É..." oninput="sendHint()">` : `<div style="opacity:0.7">–ì–æ–≤–æ—Ä–∏—Ç–µ –≤ –∑–≤–æ–Ω–∫–µ!</div>`}
                <button class="btn" style="background:#2ecc71; margin-top:20px" onclick="ws.send(JSON.stringify({type:'CORRECT'}))">–ï–°–¢–¨! ‚úÖ</button>
            `;
        } 
        // 2. –¢–´ –£–ì–ê–î–´–í–ê–ï–®–¨ (–°–≤–æ—è –∫–æ–º–∞–Ω–¥–∞)
        else if(d.role === 'guesser') {
            container.innerHTML = `
                <div class="status-badge">–¢–´ –£–ì–ê–î–´–í–ê–ï–®–¨</div>
                <div style="opacity:0.7; margin-top:20px">–í–µ–¥—É—â–∏–π: ${d.explainerName}</div>
                ${d.mode === 'online' ? 
                    `<div id="liveHintText" style="font-size:1.5rem; color:var(--neon); margin-top:30px; min-height:50px">...</div>` : 
                    `<div style="font-size:1.2rem; margin-top:30px">–°–ª—É—à–∞–π –∑–≤–æ–Ω–æ–∫! üéß</div>`
                }
            `;
        } 
        // 3. –ó–†–ò–¢–ï–õ–¨ (–ß—É–∂–∞—è –∫–æ–º–∞–Ω–¥–∞)
        else {
            container.innerHTML = `
                <div class="status-badge" style="background:#555; color:white">–•–û–î –ü–†–û–¢–ò–í–ù–ò–ö–ê</div>
                <div style="margin-top:20px">–û–±—ä—è—Å–Ω—è–µ—Ç: ${d.explainerName}</div>
                <div style="opacity:0.5; font-size:0.8rem; margin-top:50px">–ñ–¥–µ–º —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥–∏...</div>
            `;
        }
    }

    function startTimer(sec) {
        const bar = document.getElementById('timerBar');
        bar.style.transition = 'none';
        bar.style.width = '100%';
        setTimeout(() => {
            bar.style.transition = `width ${sec}s linear`;
            bar.style.width = '0%';
        }, 100);
    }
</script>
</body>
</html>
